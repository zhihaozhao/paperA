2025-08-14 20:27:24,314 [INFO] Starting training with args: {'model': 'enhanced', 'difficulty': 'hard', 'seed': 2, 'F': 52, 'T': 128, 'num_classes': 8, 'epochs': 100, 'batch': 1024, 'n_samples': 20000, 'early_metric': 'macro_f1', 'patience': 10, 'ckpt_dir': 'checkpoints\\', 'logit_l2': 0.1, 'sc_corr_rho': 0.5, 'env_burst_rate': 0.2, 'gain_drift_std': 0.6, 'class_overlap': 0.8, 'temp_mode': 'logspace', 'temp_min': 1.0, 'temp_max': 5.0, 'temp_steps': 100, 'val_split': 0.5, 'fixed_temp': 1.0, 'label_noise_prob': 0.1, 'out_json': 'results\\paperA_enhanced_hard_2.json'}
2025-08-14 20:27:24,315 [INFO] Logs saved to: results\train_eval_2_hard.log
2025-08-14 20:27:24,346 [INFO] Using device: cuda
2025-08-14 20:30:37,186 [INFO] Dataset: Train=14000, Val=3000, Test=3000
2025-08-14 20:30:37,288 [INFO] Model: enhanced with 61184 params
2025-08-14 20:31:53,005 [ERROR] Error: [Errno 22] Invalid argument
Traceback (most recent call last):
  File "E:\paperA\paperA\src\train_eval.py", line 409, in main
    for xb, yb in val_loader:
  File "D:\anaconda\Lib\site-packages\torch\utils\data\dataloader.py", line 493, in __iter__
    return self._get_iterator()
           ^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda\Lib\site-packages\torch\utils\data\dataloader.py", line 424, in _get_iterator
    return _MultiProcessingDataLoaderIter(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda\Lib\site-packages\torch\utils\data\dataloader.py", line 1171, in __init__
    w.start()
  File "D:\anaconda\Lib\multiprocessing\process.py", line 121, in start
    self._popen = self._Popen(self)
                  ^^^^^^^^^^^^^^^^^
  File "D:\anaconda\Lib\multiprocessing\context.py", line 224, in _Popen
    return _default_context.get_context().Process._Popen(process_obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda\Lib\multiprocessing\context.py", line 336, in _Popen
    return Popen(process_obj)
           ^^^^^^^^^^^^^^^^^^
  File "D:\anaconda\Lib\multiprocessing\popen_spawn_win32.py", line 95, in __init__
    reduction.dump(process_obj, to_child)
  File "D:\anaconda\Lib\multiprocessing\reduction.py", line 60, in dump
    ForkingPickler(file, protocol).dump(obj)
OSError: [Errno 22] Invalid argument
2025-08-14 20:31:58,703 [INFO] Starting training with args: {'model': 'bilstm', 'difficulty': 'hard', 'seed': 2, 'F': 52, 'T': 128, 'num_classes': 8, 'epochs': 100, 'batch': 1024, 'n_samples': 20000, 'early_metric': 'macro_f1', 'patience': 10, 'ckpt_dir': 'checkpoints\\', 'logit_l2': 0.1, 'sc_corr_rho': 0.5, 'env_burst_rate': 0.2, 'gain_drift_std': 0.6, 'class_overlap': 0.8, 'temp_mode': 'logspace', 'temp_min': 1.0, 'temp_max': 5.0, 'temp_steps': 100, 'val_split': 0.5, 'fixed_temp': 1.0, 'label_noise_prob': 0.1, 'out_json': 'results\\paperA_bilstm_hard_2.json'}
2025-08-14 20:31:58,703 [INFO] Logs saved to: results\train_eval_2_hard.log
2025-08-14 20:31:58,735 [INFO] Using device: cuda
2025-08-14 20:35:12,217 [INFO] Dataset: Train=14000, Val=3000, Test=3000
2025-08-14 20:35:12,360 [INFO] Model: bilstm with 583688 params
2025-08-14 20:35:53,165 [INFO] Epoch 1/100 - Val Loss: 1.8967
2025-08-14 20:36:07,363 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:36:38,541 [INFO] Epoch 2/100 - Val Loss: 1.4900
2025-08-14 20:36:52,558 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:37:23,103 [INFO] Epoch 3/100 - Val Loss: 1.1768
2025-08-14 20:37:37,158 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:38:07,726 [INFO] Epoch 4/100 - Val Loss: 0.9887
2025-08-14 20:38:21,937 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:38:52,483 [INFO] Epoch 5/100 - Val Loss: 1.0657
2025-08-14 20:39:06,688 [INFO] Epoch 5/100 - Train Loss: 1.3887, Val Loss: 1.0657, Val macro_f1: 0.5820, Avg Reg Loss: 0.337252
2025-08-14 20:39:37,295 [INFO] Epoch 6/100 - Val Loss: 0.8870
2025-08-14 20:39:51,693 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:40:23,654 [INFO] Epoch 7/100 - Val Loss: 0.8813
2025-08-14 20:41:08,441 [INFO] Epoch 8/100 - Val Loss: 0.8733
2025-08-14 20:41:53,268 [INFO] Epoch 9/100 - Val Loss: 1.2115
2025-08-14 20:42:38,845 [INFO] Epoch 10/100 - Val Loss: 0.9446
2025-08-14 20:42:52,842 [INFO] Epoch 10/100 - Train Loss: 1.3409, Val Loss: 0.9446, Val macro_f1: 0.5998, Avg Reg Loss: 0.316521
2025-08-14 20:43:24,158 [INFO] Epoch 11/100 - Val Loss: 0.8566
2025-08-14 20:43:38,494 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:44:09,994 [INFO] Epoch 12/100 - Val Loss: 0.8415
2025-08-14 20:44:54,794 [INFO] Epoch 13/100 - Val Loss: 0.8324
2025-08-14 20:45:39,753 [INFO] Epoch 14/100 - Val Loss: 0.8137
2025-08-14 20:45:53,997 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:46:25,387 [INFO] Epoch 15/100 - Val Loss: 0.8113
2025-08-14 20:46:39,565 [INFO] Epoch 15/100 - Train Loss: 1.1679, Val Loss: 0.8113, Val macro_f1: 0.6771, Avg Reg Loss: 0.345271
2025-08-14 20:47:10,375 [INFO] Epoch 16/100 - Val Loss: 0.8148
2025-08-14 20:47:55,726 [INFO] Epoch 17/100 - Val Loss: 0.8190
2025-08-14 20:48:41,297 [INFO] Epoch 18/100 - Val Loss: 0.7867
2025-08-14 20:48:55,354 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:49:25,710 [INFO] Epoch 19/100 - Val Loss: 0.7846
2025-08-14 20:50:11,087 [INFO] Epoch 20/100 - Val Loss: 1.3989
2025-08-14 20:50:29,906 [INFO] Epoch 20/100 - Train Loss: 1.3090, Val Loss: 1.3989, Val macro_f1: 0.4282, Avg Reg Loss: 0.348878
2025-08-14 20:51:00,102 [INFO] Epoch 21/100 - Val Loss: 1.1101
2025-08-14 20:51:44,263 [INFO] Epoch 22/100 - Val Loss: 0.9681
2025-08-14 20:52:29,408 [INFO] Epoch 23/100 - Val Loss: 0.9951
2025-08-14 20:53:15,826 [INFO] Epoch 24/100 - Val Loss: 0.8448
2025-08-14 20:54:01,409 [INFO] Epoch 25/100 - Val Loss: 0.9918
2025-08-14 20:54:15,644 [INFO] Epoch 25/100 - Train Loss: 1.1705, Val Loss: 0.9918, Val macro_f1: 0.5662, Avg Reg Loss: 0.343724
2025-08-14 20:54:46,849 [INFO] Epoch 26/100 - Val Loss: 0.8404
2025-08-14 20:55:33,210 [INFO] Epoch 27/100 - Val Loss: 0.7782
2025-08-14 20:55:48,186 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:56:19,587 [INFO] Epoch 28/100 - Val Loss: 0.7215
2025-08-14 20:56:33,808 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:57:04,386 [INFO] Epoch 29/100 - Val Loss: 0.6651
2025-08-14 20:57:18,602 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:57:49,347 [INFO] Epoch 30/100 - Val Loss: 0.7463
2025-08-14 20:58:03,387 [INFO] Epoch 30/100 - Train Loss: 1.0510, Val Loss: 0.7463, Val macro_f1: 0.7272, Avg Reg Loss: 0.351908
2025-08-14 20:58:33,943 [INFO] Epoch 31/100 - Val Loss: 0.6038
2025-08-14 20:58:48,193 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 20:59:19,367 [INFO] Epoch 32/100 - Val Loss: 0.8540
2025-08-14 21:00:04,875 [INFO] Epoch 33/100 - Val Loss: 0.7029
2025-08-14 21:00:51,088 [INFO] Epoch 34/100 - Val Loss: 0.5195
2025-08-14 21:01:05,317 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:01:36,671 [INFO] Epoch 35/100 - Val Loss: 0.9115
2025-08-14 21:01:50,877 [INFO] Epoch 35/100 - Train Loss: 0.8860, Val Loss: 0.9115, Val macro_f1: 0.6598, Avg Reg Loss: 0.371353
2025-08-14 21:02:21,481 [INFO] Epoch 36/100 - Val Loss: 0.5704
2025-08-14 21:03:06,257 [INFO] Epoch 37/100 - Val Loss: 0.4874
2025-08-14 21:03:21,067 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:03:52,257 [INFO] Epoch 38/100 - Val Loss: 0.4012
2025-08-14 21:04:06,634 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:04:37,434 [INFO] Epoch 39/100 - Val Loss: 0.3900
2025-08-14 21:05:22,391 [INFO] Epoch 40/100 - Val Loss: 0.9203
2025-08-14 21:05:36,676 [INFO] Epoch 40/100 - Train Loss: 1.4112, Val Loss: 0.9203, Val macro_f1: 0.6466, Avg Reg Loss: 0.357198
2025-08-14 21:06:08,023 [INFO] Epoch 41/100 - Val Loss: 0.7019
2025-08-14 21:06:52,963 [INFO] Epoch 42/100 - Val Loss: 0.4804
2025-08-14 21:07:37,820 [INFO] Epoch 43/100 - Val Loss: 0.4827
2025-08-14 21:08:23,388 [INFO] Epoch 44/100 - Val Loss: 0.4217
2025-08-14 21:09:09,332 [INFO] Epoch 45/100 - Val Loss: 0.6936
2025-08-14 21:09:23,551 [INFO] Epoch 45/100 - Train Loss: 1.0037, Val Loss: 0.6936, Val macro_f1: 0.7158, Avg Reg Loss: 0.353736
2025-08-14 21:09:54,165 [INFO] Epoch 46/100 - Val Loss: 0.5129
2025-08-14 21:10:39,324 [INFO] Epoch 47/100 - Val Loss: 0.4460
2025-08-14 21:11:23,892 [INFO] Epoch 48/100 - Val Loss: 0.4102
2025-08-14 21:11:38,349 [INFO] Early stopping at epoch 48
2025-08-14 21:11:52,520 [INFO] Collected test logits and targets
2025-08-14 21:11:52,654 [INFO] Calibration: T=0.5730, Details={'temperature': 0.573034405708313, 'best_nll': 0.2902536988258362, 'method': 'logspace'}
2025-08-14 21:11:52,915 [INFO] Saved full results to results\paperA_bilstm_hard_2.json
2025-08-14 21:11:52,916 [INFO] Updated registry: results\registry.csv
2025-08-14 21:11:57,700 [INFO] Starting training with args: {'model': 'cnn', 'difficulty': 'hard', 'seed': 2, 'F': 52, 'T': 128, 'num_classes': 8, 'epochs': 100, 'batch': 1024, 'n_samples': 20000, 'early_metric': 'macro_f1', 'patience': 10, 'ckpt_dir': 'checkpoints\\', 'logit_l2': 0.1, 'sc_corr_rho': 0.5, 'env_burst_rate': 0.2, 'gain_drift_std': 0.6, 'class_overlap': 0.8, 'temp_mode': 'logspace', 'temp_min': 1.0, 'temp_max': 5.0, 'temp_steps': 100, 'val_split': 0.5, 'fixed_temp': 1.0, 'label_noise_prob': 0.1, 'out_json': 'results\\paperA_cnn_hard_2.json'}
2025-08-14 21:11:57,700 [INFO] Logs saved to: results\train_eval_2_hard.log
2025-08-14 21:11:57,728 [INFO] Using device: cuda
2025-08-14 21:15:14,708 [INFO] Dataset: Train=14000, Val=3000, Test=3000
2025-08-14 21:15:14,851 [INFO] Model: cnn with 3427848 params
2025-08-14 21:15:58,559 [INFO] Epoch 1/100 - Val Loss: 1.2765
2025-08-14 21:16:13,702 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:16:45,320 [INFO] Epoch 2/100 - Val Loss: 0.6395
2025-08-14 21:17:00,205 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:17:30,848 [INFO] Epoch 3/100 - Val Loss: 0.5230
2025-08-14 21:17:45,685 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:18:16,937 [INFO] Epoch 4/100 - Val Loss: 0.4312
2025-08-14 21:18:31,722 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:19:02,313 [INFO] Epoch 5/100 - Val Loss: 0.3485
2025-08-14 21:19:16,544 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:19:16,545 [INFO] Epoch 5/100 - Train Loss: 0.7905, Val Loss: 0.3485, Val macro_f1: 0.9276, Avg Reg Loss: 0.405885
2025-08-14 21:19:48,038 [INFO] Epoch 6/100 - Val Loss: 0.2981
2025-08-14 21:20:02,355 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:20:33,882 [INFO] Epoch 7/100 - Val Loss: 0.2423
2025-08-14 21:20:48,077 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:21:19,612 [INFO] Epoch 8/100 - Val Loss: 0.2080
2025-08-14 21:21:33,836 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:22:05,391 [INFO] Epoch 9/100 - Val Loss: 0.1864
2025-08-14 21:22:19,629 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:22:50,377 [INFO] Epoch 10/100 - Val Loss: 0.1764
2025-08-14 21:23:04,651 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:23:04,652 [INFO] Epoch 10/100 - Train Loss: 0.5770, Val Loss: 0.1764, Val macro_f1: 0.9849, Avg Reg Loss: 0.406466
2025-08-14 21:23:36,341 [INFO] Epoch 11/100 - Val Loss: 0.1650
2025-08-14 21:23:50,639 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:24:21,412 [INFO] Epoch 12/100 - Val Loss: 0.1607
2025-08-14 21:24:36,401 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:25:07,782 [INFO] Epoch 13/100 - Val Loss: 0.1577
2025-08-14 21:25:54,909 [INFO] Epoch 14/100 - Val Loss: 0.1533
2025-08-14 21:26:09,820 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:26:41,965 [INFO] Epoch 15/100 - Val Loss: 0.1486
2025-08-14 21:26:56,776 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:26:56,777 [INFO] Epoch 15/100 - Train Loss: 0.5369, Val Loss: 0.1486, Val macro_f1: 0.9900, Avg Reg Loss: 0.404599
2025-08-14 21:27:27,713 [INFO] Epoch 16/100 - Val Loss: 0.1495
2025-08-14 21:27:41,953 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:28:13,077 [INFO] Epoch 17/100 - Val Loss: 0.1460
2025-08-14 21:28:27,891 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:28:58,403 [INFO] Epoch 18/100 - Val Loss: 0.1374
2025-08-14 21:29:44,271 [INFO] Epoch 19/100 - Val Loss: 0.1362
2025-08-14 21:29:58,608 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:30:30,892 [INFO] Epoch 20/100 - Val Loss: 0.1339
2025-08-14 21:30:45,065 [INFO] Epoch 20/100 - Train Loss: 0.5167, Val Loss: 0.1339, Val macro_f1: 0.9917, Avg Reg Loss: 0.400738
2025-08-14 21:31:16,593 [INFO] Epoch 21/100 - Val Loss: 0.1369
2025-08-14 21:31:30,826 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:32:02,372 [INFO] Epoch 22/100 - Val Loss: 0.1328
2025-08-14 21:32:16,619 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:32:47,415 [INFO] Epoch 23/100 - Val Loss: 0.1336
2025-08-14 21:33:01,489 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:33:32,218 [INFO] Epoch 24/100 - Val Loss: 0.1319
2025-08-14 21:34:17,574 [INFO] Epoch 25/100 - Val Loss: 0.1303
2025-08-14 21:34:31,790 [INFO] Epoch 25/100 - Train Loss: 0.5097, Val Loss: 0.1303, Val macro_f1: 0.9937, Avg Reg Loss: 0.400753
2025-08-14 21:35:02,984 [INFO] Epoch 26/100 - Val Loss: 0.1291
2025-08-14 21:35:48,285 [INFO] Epoch 27/100 - Val Loss: 0.1342
2025-08-14 21:36:36,893 [INFO] Epoch 28/100 - Val Loss: 0.1291
2025-08-14 21:37:21,554 [INFO] Epoch 29/100 - Val Loss: 0.1286
2025-08-14 21:38:06,550 [INFO] Epoch 30/100 - Val Loss: 0.1284
2025-08-14 21:38:21,303 [INFO] Epoch 30/100 - Train Loss: 0.5052, Val Loss: 0.1284, Val macro_f1: 0.9937, Avg Reg Loss: 0.399064
2025-08-14 21:38:52,158 [INFO] Epoch 31/100 - Val Loss: 0.1248
2025-08-14 21:39:38,169 [INFO] Epoch 32/100 - Val Loss: 0.1282
2025-08-14 21:39:53,122 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:40:24,809 [INFO] Epoch 33/100 - Val Loss: 0.1254
2025-08-14 21:41:10,460 [INFO] Epoch 34/100 - Val Loss: 0.1254
2025-08-14 21:41:24,581 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:41:56,029 [INFO] Epoch 35/100 - Val Loss: 0.1283
2025-08-14 21:42:10,461 [INFO] Epoch 35/100 - Train Loss: 0.5032, Val Loss: 0.1283, Val macro_f1: 0.9941, Avg Reg Loss: 0.399013
2025-08-14 21:42:43,429 [INFO] Epoch 36/100 - Val Loss: 0.1261
2025-08-14 21:43:31,042 [INFO] Epoch 37/100 - Val Loss: 0.1305
2025-08-14 21:43:46,461 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:44:18,429 [INFO] Epoch 38/100 - Val Loss: 0.1277
2025-08-14 21:45:05,820 [INFO] Epoch 39/100 - Val Loss: 0.1264
2025-08-14 21:45:20,840 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:45:51,809 [INFO] Epoch 40/100 - Val Loss: 0.1265
2025-08-14 21:46:06,262 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:46:06,263 [INFO] Epoch 40/100 - Train Loss: 0.5020, Val Loss: 0.1265, Val macro_f1: 0.9951, Avg Reg Loss: 0.398882
2025-08-14 21:46:38,773 [INFO] Epoch 41/100 - Val Loss: 0.1243
2025-08-14 21:47:24,839 [INFO] Epoch 42/100 - Val Loss: 0.1280
2025-08-14 21:48:10,929 [INFO] Epoch 43/100 - Val Loss: 0.1251
2025-08-14 21:48:56,347 [INFO] Epoch 44/100 - Val Loss: 0.1257
2025-08-14 21:49:11,347 [INFO] Best model saved to checkpoints\best_2_hard.pth
2025-08-14 21:49:42,334 [INFO] Epoch 45/100 - Val Loss: 0.1243
2025-08-14 21:49:56,148 [INFO] Epoch 45/100 - Train Loss: 0.5006, Val Loss: 0.1243, Val macro_f1: 0.9951, Avg Reg Loss: 0.398168
